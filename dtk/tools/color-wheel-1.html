<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Offline Color Wheel V3</title>
<style>
  body {
    font-family: sans-serif;
    background: #222;
    color: #eee;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
  }
  #wheel {
    cursor: crosshair;
    margin: 20px 0;
  }
  .controls {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    justify-content: center;
  }
  .controls input, .controls select {
    padding: 6px;
    font-size: 14px;
  }
  .palette {
    display: flex;
    gap: 8px;
    margin-top: 16px;
  }
  .color-box {
    width: 60px;
    height: 60px;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: bold;
    color: #fff;
    box-shadow: 0 0 4px rgba(0,0,0,0.5);
    cursor: pointer;
  }
</style>
</head>
<body>
  <h2>Offline Color Wheel V3</h2>
  <canvas id="wheel" width="300" height="300"></canvas>
  <div class="controls">
    <label>HEX: <input type="text" id="hex" value="#ff0000" maxlength="7"></label>
    <label>R: <input type="number" id="r" min="0" max="255"></label>
    <label>G: <input type="number" id="g" min="0" max="255"></label>
    <label>B: <input type="number" id="b" min="0" max="255"></label>
    <label>H: <input type="number" id="h" min="0" max="360"></label>
    <label>S: <input type="number" id="s" min="0" max="100"></label>
    <label>L: <input type="number" id="l" min="0" max="100"></label>
    <label>Theory:
      <select id="theory">
        <option value="complementary">Complementary</option>
        <option value="analogous">Analogous</option>
        <option value="triadic">Triadic</option>
      </select>
    </label>
    <button id="copyAll">Copy HEX Codes</button>
  </div>
  <div class="palette" id="palette"></div>

<script>
const canvas = document.getElementById('wheel');
const ctx = canvas.getContext('2d');
const palette = document.getElementById('palette');
const hexInput = document.getElementById('hex');
const inputs = ['r','g','b','h','s','l'].map(id => document.getElementById(id));
const theory = document.getElementById('theory');
const copyBtn = document.getElementById('copyAll');
const center = 150;
let base = {h:0,s:100,l:50};

function drawWheel(){
  for(let i=0;i<360;i++){
    ctx.beginPath();
    ctx.moveTo(center, center);
    ctx.arc(center, center, center, (i-1)*Math.PI/180, i*Math.PI/180);
    ctx.closePath();
    ctx.fillStyle = `hsl(${i},100%,50%)`;
    ctx.fill();
  }
}

function hslToRgb(h,s,l){
  s/=100; l/=100;
  let c=(1-Math.abs(2*l-1))*s, x=c*(1-Math.abs((h/60)%2-1)), m=l-c/2;
  let [r,g,b] = h<60?[c,x,0]:h<120?[x,c,0]:h<180?[0,c,x]:h<240?[0,x,c]:h<300?[x,0,c]:[c,0,0];
  return [Math.round((r+m)*255),Math.round((g+m)*255),Math.round((b+m)*255)];
}

function rgbToHsl(r,g,b){
  r/=255;g/=255; b/=255;
  let max=Math.max(r,g,b),min=Math.min(r,g,b),h,s,l=(max+min)/2,d=max-min;
  if(d===0){h=s=0;} else {
    s = l>0.5? d/(2-max-min): d/(max+min);
    if(max===r) h = ((g-b)/d + (g<b?6:0));
    else if(max===g) h = (b-r)/d + 2;
    else h = (r-g)/d +4;
    h*=60;
  }
  return [ Math.round(h), Math.round(s*100), Math.round(l*100) ];
}

function rgbToHex(r,g,b){
  return "#" + [r,g,b].map(c=>c.toString(16).padStart(2,"0")).join("");
}

function updateInputs(){
  const [r,g,b] = hslToRgb(base.h, base.s, base.l);
  const [h,s,l] = [base.h, base.s, base.l];
  hexInput.value = rgbToHex(r,g,b);
  inputs[0].value = r; inputs[1].value = g; inputs[2].value = b;
  inputs[3].value = h; inputs[4].value = s; inputs[5].value = l;
}

function getHarmonyHues(h, type){
  if(type==='complementary') return [h, (h+180)%360];
  if(type==='analogous') return [ (h+330)%360, h, (h+30)%360 ];
  if(type==='triadic') return [ h, (h+120)%360, (h+240)%360 ];
}

function updatePalette(){
  palette.innerHTML = '';
  getHarmonyHues(base.h, theory.value).forEach(h=>{
    const [r,g,b] = hslToRgb(h, base.s, base.l);
    const hex = rgbToHex(r,g,b);
    const box = document.createElement('div');
    box.className = 'color-box';
    box.style.background = hex;
    box.textContent = hex;
    box.onclick = () => { navigator.clipboard.writeText(hex); box.textContent='COPIED';
      setTimeout(()=>box.textContent=hex, 800); };
    palette.appendChild(box);
  });
}

canvas.addEventListener('click', (e) => {
  const x = e.offsetX - center, y = e.offsetY - center;
  let angle = Math.atan2(y,x)*(180/Math.PI); if(angle<0) angle+=360;
  base.h = Math.round(angle);
  updateInputs(); updatePalette();
});
hexInput.addEventListener('input', ()=>{
  if(/^#([0-9a-f]{6})$/i.test(hexInput.value)){
    let hex=hexInput.value, r=parseInt(hex.slice(1,3),16),
        g=parseInt(hex.slice(3,5),16), b=parseInt(hex.slice(5,7),16);
    const [h,s,l] = rgbToHsl(r,g,b);
    base = {h,s,l}; updateInputs(); updatePalette();
  }
});
inputs.forEach(inp=>{
  inp.addEventListener('input', ()=>{
    const r=+inputs[0].value, g=+inputs[1].value, b=+inputs[2].value;
    const h=+inputs[3].value, s=+inputs[4].value, l=+inputs[5].value;
    if(!isNaN(r)&&!isNaN(g)&&!isNaN(b) && !isNaN(h)&&!isNaN(s)&&!isNaN(l)){
      base = {h:Math.min(360,h),s:Math.min(100,s),l:Math.min(100,l)};
      updateInputs(); updatePalette();
    }
  });
});
theory.addEventListener('change', updatePalette);
copyBtn.addEventListener('click', ()=>{
  const list = Array.from(palette.children).map(b=>b.textContent).join(', ');
  navigator.clipboard.writeText(list);
  copyBtn.textContent='COPIED!'; setTimeout(()=>copyBtn.textContent='Copy HEX Codes',1000);
});

drawWheel(); updateInputs(); updatePalette();
</script>
</body>
</html>